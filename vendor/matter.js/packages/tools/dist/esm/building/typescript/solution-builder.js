/**
 * @license
 * Copyright 2022-2025 Matter.js Authors
 * SPDX-License-Identifier: Apache-2.0
 */
import { existsSync } from "node:fs";
import { join } from "node:path";
import {
  createSolutionBuilder,
  createSolutionBuilderHost,
  ExitStatus,
  sys
} from "typescript";
import { BuildError, InternalBuildError } from "../error.js";
import { TypescriptContext } from "./context.js";
const BUILD_DIAGNOSTICS = false;
async function createSolutionBuilderContext(workspace, graph) {
  let diagnostics;
  const host = createSolutionBuilderHost();
  host.reportDiagnostic = (diagnostic) => (diagnostics ??= []).push(diagnostic);
  let context;
  function currentContext() {
    if (context === void 0) {
      throw new Error("Build context accessed with no ");
    }
    return context;
  }
  instrumentHostWithInterceptors(host, currentContext, graph);
  const builder = createSolutionBuilder(host, [workspace.resolve("tsconfig.json")], {});
  TypescriptContext.diagnose(diagnostics);
  return {
    async build(pkg, path, refreshCallback, _emit) {
      context = {
        refreshCallback
      };
      if (path === "src" && pkg.isLibrary && pkg.supportsEsm && pkg.supportsCjs) {
        const esmDeclIdentifier = new RegExp(
          `^(${pkg.resolve("dist").replace(/[\\/]/g, "[\\/]")}[\\/](?:.*))esm([\\/].*(?:\\.d\\.ts|\\.d\\.ts\\.map))$`
        );
        context.fileWrite = (writeFile, filename, contents, writeBom) => {
          const match = filename.match(esmDeclIdentifier);
          if (!match) {
            return;
          }
          writeFile(`${match[1]}cjs${match[2]}`, contents, writeBom);
        };
      }
      try {
        const status = builder.build(pkg.resolve(join(path, "tsconfig.json")));
        TypescriptContext.diagnose(diagnostics);
        switch (status) {
          case void 0:
          case ExitStatus.Success:
            break;
          case ExitStatus.InvalidProject_OutputsSkipped:
            throw new BuildError(
              `Typescript does not think ${path} is part of the project, this is probably a build tooling error`
            );
          case ExitStatus.ProjectReferenceCycle_OutputsSkipped:
            throw new BuildError(
              `Typescript identified a cyclical project reference in ${path}, please check package dependencies`
            );
          default:
            throw new InternalBuildError(`Build error ${ExitStatus[status]} without diagnostics`);
        }
      } finally {
        context = void 0;
      }
    }
  };
}
function instrumentHostWithInterceptors(host, currentContext, graph) {
  const moduleIdentifier = graph ? new RegExp(`^(${graph.nodes.map((node) => node.pkg.path).join("|")})[\\/]dist[\\/](?:esm|cjs)/(.*).d.ts$`) : void 0;
  const writeFile = host.writeFile ?? sys.writeFile;
  host.writeFile = (path, data, writeBom) => {
    const context = currentContext();
    context.refreshCallback();
    writeFile(path, data, writeBom);
    context.fileWrite?.(writeFile, path, data, writeBom);
  };
  let resolveModuleNameLiterals;
  const resolveModuleNameLiteralsInterceptor = (...args) => {
    currentContext().refreshCallback();
    const result = resolveModuleNameLiterals(...args);
    if (!BUILD_DIAGNOSTICS) {
      return result;
    }
    for (const entry of result) {
      const filename = entry.resolvedModule?.resolvedFileName;
      const match = moduleIdentifier && filename?.match(moduleIdentifier);
      if (match) {
        const sourceFilename = `${match[1]}/src/${match[2]}.ts`;
        if (existsSync(sourceFilename)) {
          console.warn(".d.ts reference", sourceFilename);
        }
      }
    }
    return result;
  };
  const createProgram = host.createProgram;
  host.createProgram = (...args) => {
    const compilerHost = args[2];
    if (compilerHost && compilerHost.resolveModuleNameLiterals !== resolveModuleNameLiteralsInterceptor) {
      resolveModuleNameLiterals = compilerHost.resolveModuleNameLiterals;
      compilerHost.resolveModuleNameLiterals = resolveModuleNameLiteralsInterceptor;
    }
    const result = createProgram(...args);
    const getCompilerOptions = result.getCompilerOptions;
    result.getCompilerOptions = (...args2) => {
      currentContext().refreshCallback();
      return getCompilerOptions(...args2);
    };
    return result;
  };
}
export {
  createSolutionBuilderContext
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2J1aWxkaW5nL3R5cGVzY3JpcHQvc29sdXRpb24tYnVpbGRlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjItMjAyNSBNYXR0ZXIuanMgQXV0aG9yc1xuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSBcIm5vZGU6ZnNcIjtcbmltcG9ydCB7IGpvaW4gfSBmcm9tIFwibm9kZTpwYXRoXCI7XG5pbXBvcnQge1xuICAgIENvbXBpbGVySG9zdCxcbiAgICBjcmVhdGVTb2x1dGlvbkJ1aWxkZXIsXG4gICAgY3JlYXRlU29sdXRpb25CdWlsZGVySG9zdCxcbiAgICBEaWFnbm9zdGljLFxuICAgIEVtaXRBbmRTZW1hbnRpY0RpYWdub3N0aWNzQnVpbGRlclByb2dyYW0sXG4gICAgRXhpdFN0YXR1cyxcbiAgICBTb2x1dGlvbkJ1aWxkZXJIb3N0LFxuICAgIHN5cyxcbn0gZnJvbSBcInR5cGVzY3JpcHRcIjtcbmltcG9ydCB7IFBhY2thZ2UgfSBmcm9tIFwiLi4vLi4vdXRpbC9wYWNrYWdlLmpzXCI7XG5pbXBvcnQgeyBCdWlsZEVycm9yLCBJbnRlcm5hbEJ1aWxkRXJyb3IgfSBmcm9tIFwiLi4vZXJyb3IuanNcIjtcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4uL2dyYXBoLmpzXCI7XG5pbXBvcnQgeyBUeXBlc2NyaXB0Q29udGV4dCB9IGZyb20gXCIuL2NvbnRleHQuanNcIjtcblxuY29uc3QgQlVJTERfRElBR05PU1RJQ1MgPSBmYWxzZTtcblxuaW50ZXJmYWNlIFBhY2thZ2VCdWlsZENvbnRleHQge1xuICAgIGZpbGVXcml0ZT86ICh3cml0ZUZpbGU6IHR5cGVvZiBzeXMud3JpdGVGaWxlLCBmaWxlbmFtZTogc3RyaW5nLCBjb250ZW50czogc3RyaW5nLCB3cml0ZUJvbT86IGJvb2xlYW4pID0+IHZvaWQ7XG4gICAgcmVmcmVzaENhbGxiYWNrKCk6IHZvaWQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTb2x1dGlvbkJ1aWxkZXJDb250ZXh0KFxuICAgIHdvcmtzcGFjZTogUGFja2FnZSxcbiAgICBncmFwaDogR3JhcGggfCB1bmRlZmluZWQsXG4pOiBQcm9taXNlPFR5cGVzY3JpcHRDb250ZXh0PiB7XG4gICAgbGV0IGRpYWdub3N0aWNzOiB1bmRlZmluZWQgfCBEaWFnbm9zdGljW107XG4gICAgY29uc3QgaG9zdCA9IGNyZWF0ZVNvbHV0aW9uQnVpbGRlckhvc3QoKTtcbiAgICBob3N0LnJlcG9ydERpYWdub3N0aWMgPSBkaWFnbm9zdGljID0+IChkaWFnbm9zdGljcyA/Pz0gW10pLnB1c2goZGlhZ25vc3RpYyk7XG4gICAgbGV0IGNvbnRleHQ6IHVuZGVmaW5lZCB8IFBhY2thZ2VCdWlsZENvbnRleHQ7XG5cbiAgICBmdW5jdGlvbiBjdXJyZW50Q29udGV4dCgpIHtcbiAgICAgICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQnVpbGQgY29udGV4dCBhY2Nlc3NlZCB3aXRoIG5vIFwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29udGV4dDtcbiAgICB9XG5cbiAgICBpbnN0cnVtZW50SG9zdFdpdGhJbnRlcmNlcHRvcnMoaG9zdCwgY3VycmVudENvbnRleHQsIGdyYXBoKTtcblxuICAgIGNvbnN0IGJ1aWxkZXIgPSBjcmVhdGVTb2x1dGlvbkJ1aWxkZXIoaG9zdCwgW3dvcmtzcGFjZS5yZXNvbHZlKFwidHNjb25maWcuanNvblwiKV0sIHt9KTtcblxuICAgIFR5cGVzY3JpcHRDb250ZXh0LmRpYWdub3NlKGRpYWdub3N0aWNzKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGFzeW5jIGJ1aWxkKHBrZzogUGFja2FnZSwgcGF0aDogc3RyaW5nLCByZWZyZXNoQ2FsbGJhY2s6ICgpID0+IHZvaWQsIF9lbWl0PzogYm9vbGVhbikge1xuICAgICAgICAgICAgY29udGV4dCA9IHtcbiAgICAgICAgICAgICAgICByZWZyZXNoQ2FsbGJhY2ssXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAocGF0aCA9PT0gXCJzcmNcIiAmJiBwa2cuaXNMaWJyYXJ5ICYmIHBrZy5zdXBwb3J0c0VzbSAmJiBwa2cuc3VwcG9ydHNDanMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlc21EZWNsSWRlbnRpZmllciA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgICAgIGBeKCR7cGtnLnJlc29sdmUoXCJkaXN0XCIpLnJlcGxhY2UoL1tcXFxcL10vZywgXCJbXFxcXC9dXCIpfVtcXFxcL10oPzouKikpZXNtKFtcXFxcL10uKig/OlxcXFwuZFxcXFwudHN8XFxcXC5kXFxcXC50c1xcXFwubWFwKSkkYCxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsZVdyaXRlID0gKHdyaXRlRmlsZSwgZmlsZW5hbWUsIGNvbnRlbnRzLCB3cml0ZUJvbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IGZpbGVuYW1lLm1hdGNoKGVzbURlY2xJZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlRmlsZShgJHttYXRjaFsxXX1janMke21hdGNoWzJdfWAsIGNvbnRlbnRzLCB3cml0ZUJvbSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBidWlsZGVyLmJ1aWxkKHBrZy5yZXNvbHZlKGpvaW4ocGF0aCwgXCJ0c2NvbmZpZy5qc29uXCIpKSk7XG5cbiAgICAgICAgICAgICAgICBUeXBlc2NyaXB0Q29udGV4dC5kaWFnbm9zZShkaWFnbm9zdGljcyk7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFeGl0U3RhdHVzLlN1Y2Nlc3M6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIEV4aXRTdGF0dXMuSW52YWxpZFByb2plY3RfT3V0cHV0c1NraXBwZWQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQnVpbGRFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgVHlwZXNjcmlwdCBkb2VzIG5vdCB0aGluayAke3BhdGh9IGlzIHBhcnQgb2YgdGhlIHByb2plY3QsIHRoaXMgaXMgcHJvYmFibHkgYSBidWlsZCB0b29saW5nIGVycm9yYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFeGl0U3RhdHVzLlByb2plY3RSZWZlcmVuY2VDeWNsZV9PdXRwdXRzU2tpcHBlZDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBCdWlsZEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBUeXBlc2NyaXB0IGlkZW50aWZpZWQgYSBjeWNsaWNhbCBwcm9qZWN0IHJlZmVyZW5jZSBpbiAke3BhdGh9LCBwbGVhc2UgY2hlY2sgcGFja2FnZSBkZXBlbmRlbmNpZXNgLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsQnVpbGRFcnJvcihgQnVpbGQgZXJyb3IgJHtFeGl0U3RhdHVzW3N0YXR1c119IHdpdGhvdXQgZGlhZ25vc3RpY3NgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGNvbnRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgfTtcbn1cblxuLyoqXG4gKiBBZGRzIGludGVyY2VwdGlvbiBwb2ludHMgZm9yIG11Y2tpbmcgYXJvdW5kIGluIFRTIGludGVybmFscy5cbiAqL1xuZnVuY3Rpb24gaW5zdHJ1bWVudEhvc3RXaXRoSW50ZXJjZXB0b3JzKFxuICAgIGhvc3Q6IFNvbHV0aW9uQnVpbGRlckhvc3Q8RW1pdEFuZFNlbWFudGljRGlhZ25vc3RpY3NCdWlsZGVyUHJvZ3JhbT4sXG4gICAgY3VycmVudENvbnRleHQ6ICgpID0+IFBhY2thZ2VCdWlsZENvbnRleHQsXG4gICAgZ3JhcGg/OiBHcmFwaCxcbikge1xuICAgIC8vIE1hdGNoZXMgYW55IGZpbGUgdGhhdCBtYXkgYmUgdGhlIHR5cGUgZGVmaW5pdGlvbnMgZm9yIG9uZSBvZiBvdXIgLnRzIGZpbGVzXG4gICAgY29uc3QgbW9kdWxlSWRlbnRpZmllciA9IGdyYXBoXG4gICAgICAgID8gbmV3IFJlZ0V4cChgXigke2dyYXBoLm5vZGVzLm1hcChub2RlID0+IG5vZGUucGtnLnBhdGgpLmpvaW4oXCJ8XCIpfSlbXFxcXC9dZGlzdFtcXFxcL10oPzplc218Y2pzKS8oLiopLmQudHMkYClcbiAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAvLyBJbnN0cnVtZW50IHdyaXRlIHRvIHVwZGF0ZSBzcGlubmVyIGFuZCBiaWZ1cmNhdGUgdHlwZSBkZWZpbml0aW9uIHdyaXRlcyB0byBDSlMgaWYgcHJvamVjdCBpbmNsdWRlcyBib3RoIENKUyBhbmRcbiAgICAvLyBFU01cbiAgICBjb25zdCB3cml0ZUZpbGUgPSBob3N0LndyaXRlRmlsZSA/PyBzeXMud3JpdGVGaWxlO1xuICAgIGhvc3Qud3JpdGVGaWxlID0gKHBhdGgsIGRhdGEsIHdyaXRlQm9tKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBjdXJyZW50Q29udGV4dCgpO1xuICAgICAgICBjb250ZXh0LnJlZnJlc2hDYWxsYmFjaygpO1xuICAgICAgICB3cml0ZUZpbGUocGF0aCwgZGF0YSwgd3JpdGVCb20pO1xuICAgICAgICBjb250ZXh0LmZpbGVXcml0ZT8uKHdyaXRlRmlsZSwgcGF0aCwgZGF0YSwgd3JpdGVCb20pO1xuICAgIH07XG5cbiAgICAvLyBJbnRlcmNlcHRzIGZvciBkaWFnbm9zdGljcyBhbmQgdG8gdXBkYXRlIHNwaW5uZXJcbiAgICBsZXQgcmVzb2x2ZU1vZHVsZU5hbWVMaXRlcmFsczogQ29tcGlsZXJIb3N0W1wicmVzb2x2ZU1vZHVsZU5hbWVMaXRlcmFsc1wiXSB8IHVuZGVmaW5lZDtcbiAgICBjb25zdCByZXNvbHZlTW9kdWxlTmFtZUxpdGVyYWxzSW50ZXJjZXB0b3I6IENvbXBpbGVySG9zdFtcInJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHNcIl0gPSAoLi4uYXJncykgPT4ge1xuICAgICAgICBjdXJyZW50Q29udGV4dCgpLnJlZnJlc2hDYWxsYmFjaygpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHMhKC4uLmFyZ3MpO1xuICAgICAgICBpZiAoIUJVSUxEX0RJQUdOT1NUSUNTKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiByZXN1bHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gZW50cnkucmVzb2x2ZWRNb2R1bGU/LnJlc29sdmVkRmlsZU5hbWU7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IG1vZHVsZUlkZW50aWZpZXIgJiYgZmlsZW5hbWU/Lm1hdGNoKG1vZHVsZUlkZW50aWZpZXIpO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc291cmNlRmlsZW5hbWUgPSBgJHttYXRjaFsxXX0vc3JjLyR7bWF0Y2hbMl19LnRzYDtcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RzU3luYyhzb3VyY2VGaWxlbmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiLmQudHMgcmVmZXJlbmNlXCIsIHNvdXJjZUZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICAvLyBTb2x1dGlvbkJ1aWxkZXIgZGVzaWduIGRvZXNuJ3QgYWxsb3cgdXMgdG8gYWNjZXNzIFwicmVhbFwiIHJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHMgYmVjYXVzZSBpdCdzIHVuZGVmaW5lZCBoZXJlXG4gICAgLy8gYW5kIG9ubHkgY3JlYXRlZCBpbiBjcmVhdGVTb2x1dGlvbkJ1aWxkZXIgd2hlbiBpdCBjcmVhdGVzIHRoZSBDb21waWxlckhvc3QuICBTbyBpbnN0ZWFkIGluamVjdCB3aGVuIHRoZVxuICAgIC8vIENvbXBpbGVySG9zdCBpcyBwYXNzZWQgdG8gU29sdXRpb25CdWlsZGVySG9zdCNjcmVhdGVQcm9ncmFtXG4gICAgY29uc3QgY3JlYXRlUHJvZ3JhbSA9IGhvc3QuY3JlYXRlUHJvZ3JhbTtcbiAgICBob3N0LmNyZWF0ZVByb2dyYW0gPSAoLi4uYXJncykgPT4ge1xuICAgICAgICBjb25zdCBjb21waWxlckhvc3QgPSBhcmdzWzJdO1xuXG4gICAgICAgIC8vIEluc3RydW1lbnQgY29tcGlsZXIgaG9zdCBmb3Igc3Bpbm5lciArIGRpYWdub3N0aWNzXG4gICAgICAgIGlmIChjb21waWxlckhvc3QgJiYgY29tcGlsZXJIb3N0LnJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHMgIT09IHJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHNJbnRlcmNlcHRvcikge1xuICAgICAgICAgICAgcmVzb2x2ZU1vZHVsZU5hbWVMaXRlcmFscyA9IGNvbXBpbGVySG9zdC5yZXNvbHZlTW9kdWxlTmFtZUxpdGVyYWxzO1xuICAgICAgICAgICAgY29tcGlsZXJIb3N0LnJlc29sdmVNb2R1bGVOYW1lTGl0ZXJhbHMgPSByZXNvbHZlTW9kdWxlTmFtZUxpdGVyYWxzSW50ZXJjZXB0b3I7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGVQcm9ncmFtKC4uLmFyZ3MpO1xuXG4gICAgICAgIC8vIFRTIHJlYWRzIGNvbXBpbGVyIG9wdGlvbnMgaW4gYSBsb25nIHRpZ2h0IGxvb3Agd2hlcmUgd2Ugb3RoZXJ3aXNlIG5ldmVyIHdvdWxkIHVwZGF0ZSB0aGUgc3Bpbm5lclxuICAgICAgICBjb25zdCBnZXRDb21waWxlck9wdGlvbnMgPSByZXN1bHQuZ2V0Q29tcGlsZXJPcHRpb25zO1xuICAgICAgICByZXN1bHQuZ2V0Q29tcGlsZXJPcHRpb25zID0gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgICAgIGN1cnJlbnRDb250ZXh0KCkucmVmcmVzaENhbGxiYWNrKCk7XG4gICAgICAgICAgICByZXR1cm4gZ2V0Q29tcGlsZXJPcHRpb25zKC4uLmFyZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbn1cbiJdLAogICJtYXBwaW5ncyI6ICJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQSxTQUFTLGtCQUFrQjtBQUMzQixTQUFTLFlBQVk7QUFDckI7QUFBQSxFQUVJO0FBQUEsRUFDQTtBQUFBLEVBR0E7QUFBQSxFQUVBO0FBQUEsT0FDRztBQUVQLFNBQVMsWUFBWSwwQkFBMEI7QUFFL0MsU0FBUyx5QkFBeUI7QUFFbEMsTUFBTSxvQkFBb0I7QUFPMUIsZUFBc0IsNkJBQ2xCLFdBQ0EsT0FDMEI7QUFDMUIsTUFBSTtBQUNKLFFBQU0sT0FBTywwQkFBMEI7QUFDdkMsT0FBSyxtQkFBbUIsaUJBQWUsZ0JBQWdCLENBQUMsR0FBRyxLQUFLLFVBQVU7QUFDMUUsTUFBSTtBQUVKLFdBQVMsaUJBQWlCO0FBQ3RCLFFBQUksWUFB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
